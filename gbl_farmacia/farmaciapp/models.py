from django.db import models
from django.contrib.auth.models import User

import datetime
from datetime import date
import time



#datu-motak ikusteko:
#https://docs.djangoproject.com/en/1.7/ref/models/fields/#django.db.models.DateField


#Medikamentuari dagokion entitatea eta bere erlazioak
class Medikamentua(models.Model):
    #ident izango da medikamentuaren gako nagusia
    ident = models.CharField(primary_key=True, max_length=128)

    #ondorengo aldagaia url-etan arazorik ez emateko ident kodetua da
    identKodetua = models.IntegerField(blank=True, null=True)

    kit = models.IntegerField(blank=True)
    lote = models.CharField(blank=True, max_length=128)
    kaduzitatea = models.DateField(blank=True)
    bidalketaZenbakia = models.IntegerField(blank=True)
    bidalketaData = models.DateField(blank=True)

    #medikamentu horren zenbat unitate dauden Stock-ean adierazteko
    unitateak = models.IntegerField(default=1)

    #Jakiteko historian zehar zernabt unitate izan diren Stock-ean
    unitateak_historikoa = models.IntegerField(default=0, null=True, blank=True)


    bidalketaOrdua = models.TimeField(blank=True, null=True)

    #Medikamentuaren instantzia eskuratzen denean identzifikatzailearen bidez izendatuko da
    def __unicode__(self):
        return unicode(self.identKodetua)

#Pazienteari dagokion entitatea eta bere erlazioak
class Pazientea(models.Model):
    #ident izango da Pazientearen gako nagusia
    ident = models.AutoField(primary_key=True)

    #ensaioaren barruan zein id duen adierazteko
    idensaioan = models.CharField(max_length=128, blank=True)
    izena = models.CharField(max_length=128)

    #zein unitate klinikori dagokion paziente hau adierazteko   
    unitateKlinikoa = models.CharField(max_length=128, blank=True)

    #pazienteari dagozkion beharrezko datuak:
    pisua = models.FloatField()
    #datu gehiago behar badira hemen jartzen dira
    

    #IDENSAIOAN EDO IDENT???
    def __unicode__(self):
        return unicode(self.ident)


#Ensaioari dagokion entitatea eta bere erlazioak
class Ensaioa(models.Model):
    
    #Egoerak ensaioa itxita edo irekita dagoen adieraziko du
    egoera = models.CharField(max_length=128)

    hasieraData = models.DateField()

    #bukaera datak null balioa izatea onartu behar da, ensaioa sortzerakoan ez baitu bukaera datarik izago esleituta
    bukaeraData = models.DateField(blank=True, null=True)

    #Ensaio bakoitzak bakarra den protokolo zenbaki bat izango du
    protokoloZenbakia = models.CharField(unique=True, max_length=128)

    #titulua bakarra izango denez ensaio bakoitzarentzat ziurtasun osoz, gako nagusia izango da
    titulua = models.CharField(primary_key=True, max_length=600, unique=True)
    
    zerbitzua = models.CharField(max_length=128)
    promotorea = models.CharField(max_length=128)
    estudioMota = models.CharField(max_length=128)
    monitorea = models.CharField(max_length=128)
    monitoreaEmail = models.CharField(max_length=240, blank=True, null=True)
    monitoreaFax = models.IntegerField(blank=True, null=True)
    monitoreaTel = models.IntegerField(blank=True, null=True)
    monitoreaMugikor = models.IntegerField(blank=True, null=True)
    ikertzailea = models.CharField(max_length=128)

    #Komentarioak atributuaren balioa hutsik uztea baimendu beharra dago, ez delako betetzeko den derrigorrezko eremu bat izango
    komentarioak = models.CharField(max_length=128, blank=True)



    #Ensaioaren instantzia eskuratzen denean protokoloZenbakiaren bidez izendatuko da, titulua baino laburragoa baita
    def __unicode__(self):
        return self.protokoloZenbakia



#Dispentsazioari dagokion entitatea eta bere erlazioak
class Dispentsazioa(models.Model):
	
    bukaeraData = models.DateField()
    
    #Dispentsazioaren gako nagusia identzifikatzailea izango da
    ident = models.AutoField(primary_key=True)

    #Zein ensaiori dagon lotuta gorde behar da
    ensaioa = models.ForeignKey(Ensaioa)

    #dagokion EnsaioErrezeta objektuaren identifikatzailea
    ensaioerrezeta = models.IntegerField(default=0)

    #Aldagai honek gordeko du nork egin duen dispentsazioa
    dispentsatzailea = models.CharField(max_length=128)

    #Dispentsazioaren instantzia eskuratzen denean identifikatzailearen bidez izendatuko da
    def __unicode__(self):
        return unicode(self.ident)

   

#Erlazioak adierazteko behar diren klaseak definitzen dira ondoren


#Ensaioak eta Medikamentuak lotzen dituen entitatea da
class MedikamentuEnsaio(models.Model):
	medikamentua = models.ForeignKey(Medikamentua, null=True, related_name="medikamentua_ensaioan")
	ensaioa = models.ForeignKey(Ensaioa, null=True)

    #MedikamentuEnsaio instantzia eskuratzen denean medikamentuaren bidez izendatuko da
	def __unicode__(self):
		return unicode(self.medikamentua)# + "; " + self.ensaioa)

#Pazienteak eta Dispentsazioak lotzen dituen entitatea da
class PazienteDispentsazio(models.Model):
    #identifikatzaile autoinkremental hau izango da gako nagusia
    identBi = models.AutoField(primary_key=True)
    #identifikatzaile hau Dispentsazioaren identifikatzailearen berdina izango da
    ident = models.IntegerField(default=1)
    medikamentua = models.ForeignKey(Medikamentua, null=True)
    dispentsazioa = models.ForeignKey(Dispentsazioa, null=True, related_name="dispentsazioa_pazientearekiko")
    paziente = models.ForeignKey(Pazientea, null=True, related_name="pazientea_dispentsazioan")
    dosia = models.IntegerField(null=True, blank=True) 

    #PazienteDispentsazioren instantzia eskuratzen denean identifikatzailearen bidez izendatuko da; hau da, dispentsazioaren identifikatzailearen bitartez
    def __unicode__(self):
        return unicode(self.ident)

#Ensaioak eta Errezetak lotzen dituen entitatea da
class EnsaioErrezeta(models.Model):
    #identifikatzaile autoinkremental bat izango da gako nagusia
    ident = models.AutoField(primary_key=True)
    ensaioa = models.ForeignKey(Ensaioa, null=True)
    pazientea = models.ForeignKey(Pazientea, null=True)
    preskripzioData = models.DateField(null=True)
    hurrengoPreskripzioData = models.DateField(null=True, blank=True)

    #Aldagai honek kontrolatuko du zein erabiltzailek sortu duen errezeta
    sortzailea = models.CharField(max_length=128, blank=True, null=True)

    #Aldagai honek esango du ea errezeta 'Pendiente' egoeran dagoen edo ez; hau da, onartuta dagoen edo ez
    pendiente = models.CharField(max_length=128, default='Pendiente')

    #Eremu zabal eta ireki bat izango da nahi diren eremuak adierazteko
    gainontzekoEremuak = models.TextField(null=True, blank=True)

    #Errezetaren izena zein izango den adierazteko
    errezetaIzena = models.CharField(max_length=300, blank=True, null=True)


    #EnsaioErrezetaren instantzia eskuratzen denean identifikatzailearen bidez izendatuko da
    def __unicode__(self):
		return unicode(self.ident)


#Pazienteak eta Ensaioak lotzen dituen entitatea da
class PazienteEnsaio(models.Model):
    ensaioa = models.ForeignKey(Ensaioa, null=True, related_name="pazientea_ensaioan")
    pazientea = models.ForeignKey(Pazientea, null=True)

    #PazienteEnsaioaren instantzia eskuratzen denean dagokion ensaioaren bidez izendatuko da
    def __unicode__(self):
        return unicode(self.ensaioa)


#Erabiltzailearen profilaren informazioa gordeko duen entitatea da
class ErabiltzaileProfila(models.Model):
    # Lerro hau beharrezkoa da. ErabiltzaileProfila linkatzen du User modeloaren instantziarekin.
    erabiltzailea = models.OneToOneField(User)

    # Gehitu nahi diren atributuak
    #website = models.URLField(blank=True)
    #picture = models.ImageField(upload_to='profile_images', blank=True)
    izena = models.CharField(max_length=128)
    abizena1 = models.CharField(max_length=128)
    abizena2 = models.CharField(max_length=128)
    zerbitzua = models.CharField(max_length=128, default=1, choices=(('Farmazia', 'Farmazia'), ('Medicina', 'Medicina')))

    #Adibidez, onkologia, radiologia, etab.
    azpizerbitzua = models.CharField(max_length=300, null=True, blank=True)
    #...???

    # modelo honen instantzia bat atzitzen denean zein izenekin definituko den instantzia hori adierazten du
    def __unicode__(self):
        return self.erabiltzailea.username


